<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lumina Player v6.0</title>
    <style>
        :root {
            --primary-color: #6366f1; /* Indigo */
            --primary-hover: #4f46e5;
            --bg-color: #0f172a;      /* Slate 900 */
            --panel-bg: #1e293b;      /* Slate 800 */
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --danger-color: #ef4444;  /* Red */
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            background: #020617; 
            color: var(--text-main);
            min-height: 100vh;
            display: flex; flex-direction: column; align-items: center;
        }

        /* --- 1. New Professional Header --- */
        .app-header {
            width: 100%;
            padding: 20px 40px;
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 10;
            margin-bottom: 20px;
        }
        .logo { font-size: 1.5rem; font-weight: 700; letter-spacing: -0.5px; display: flex; align-items: center; gap: 10px; }
        .logo span { color: var(--primary-color); }
        .logo svg { width: 28px; height: 28px; fill: var(--primary-color); }

        /* --- Main Layout --- */
        .app-container {
            display: grid; grid-template-columns: 1fr 350px; gap: 20px;
            width: 95%; max-width: 1200px;
            background: var(--bg-color); border-radius: 16px; overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(255,255,255,0.05);
        }

        @media (max-width: 900px) {
            .app-container { grid-template-columns: 1fr; }
            .playlist { max-height: 400px; }
            .app-header { padding: 15px 20px; }
        }

        /* --- Player Section --- */
        .lumina-player { position: relative; width: 100%; aspect-ratio: 16/9; background: #000; group: focus; }
        .lumina-player.fullscreen { width: 100vw; height: 100vh; max-width: none; }
        video { width: 100%; height: 100%; display: block; background: #000; }
        
        /* Center Overlay (Play Icon / Welcome) */
        .overlay-center {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            pointer-events: none; opacity: 1; transition: opacity 0.3s, transform 0.3s;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            text-align: center;
        }
        .play-circle-bg {
            background: rgba(0,0,0,0.5); backdrop-filter: blur(4px);
            border-radius: 50%; padding: 25px; margin-bottom: 15px;
            transition: transform 0.2s;
        }
        .welcome-text { font-size: 1.2rem; font-weight: 600; text-shadow: 0 2px 4px rgba(0,0,0,0.8); opacity: 0; transform: translateY(10px); transition: all 0.5s; }
        
        /* Show welcome text only when paused/idle */
        .lumina-player.paused .welcome-text { opacity: 1; transform: translateY(0); }
        .lumina-player:not(.paused) .overlay-center { opacity: 0; transform: translate(-50%, -50%) scale(1.5); }

        .spinner {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            border: 4px solid rgba(255,255,255,0.1); border-top-color: var(--primary-color);
            width: 50px; height: 50px; border-radius: 50%; 
            animation: spin 1s linear infinite; display: none; pointer-events: none;
        }
        @keyframes spin { 100% { transform: translate(-50%, -50%) rotate(360deg); } }

        /* Controls */
        .controls {
            position: absolute; bottom: 0; left: 0; right: 0;
            background: linear-gradient(to top, rgba(2, 6, 23, 0.95), transparent);
            padding: 20px 20px 15px 20px;
            display: flex; flex-wrap: wrap; align-items: center;
            transition: opacity 0.3s ease;
        }
        .lumina-player.user-inactive .controls { opacity: 0; pointer-events: none; }
        .lumina-player.paused .controls { opacity: 1 !important; pointer-events: auto; }

        .progress-container { width: 100%; margin-bottom: 12px; height: 10px; cursor: pointer; display: flex; align-items: center; }
        .progress { width: 100%; height: 4px; background: rgba(255,255,255,0.2); position: relative; border-radius: 2px; transition: height 0.1s; }
        .progress-container:hover .progress { height: 6px; }
        .progress-filled { height: 100%; background: var(--primary-color); width: 0%; border-radius: 2px; position: relative; }
        .progress-filled::after {
            content: ''; position: absolute; right: -6px; top: 50%; transform: translateY(-50%);
            width: 12px; height: 12px; border-radius: 50%; background: #fff; opacity: 0; transition: opacity 0.1s;
        }
        .progress-container:hover .progress-filled::after { opacity: 1; }
        .seek-slider { position: absolute; width: 100%; height: 100%; top: -5px; left: 0; opacity: 0; cursor: pointer; }

        .btn-group, .right-controls { display: flex; align-items: center; gap: 16px; }
        .right-controls { margin-left: auto; }
        button { background: none; border: none; cursor: pointer; color: #cbd5e1; padding: 0; display: flex; align-items: center; transition: color 0.2s; }
        button:hover { color: #fff; }
        button svg { width: 22px; height: 22px; fill: currentColor; }
        
        .volume-container { display: flex; align-items: center; gap: 8px; }
        .vol-slider { width: 60px; height: 4px; -webkit-appearance: none; background: rgba(255,255,255,0.3); border-radius: 2px; cursor: pointer; }
        .vol-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 10px; height: 10px; background: #fff; border-radius: 50%; }

        .time { font-size: 13px; font-family: monospace; color: #e2e8f0; margin-left: 10px; }

        /* --- Playlist --- */
        .playlist { background: var(--panel-bg); display: flex; flex-direction: column; overflow-y: auto; border-left: 1px solid rgba(255,255,255,0.05); }
        
        .playlist-header {
            padding: 15px 20px; font-weight: 600; border-bottom: 1px solid rgba(255,255,255,0.05);
            background: var(--panel-bg); position: sticky; top: 0; z-index: 2;
            display: flex; justify-content: space-between; align-items: center;
        }
        
        .upload-btn {
            background: rgba(255,255,255,0.1); padding: 8px 12px; border-radius: 6px;
            font-size: 0.8rem; display: flex; gap: 6px; align-items: center; color: white;
            transition: all 0.2s; border: 1px solid rgba(255,255,255,0.1);
        }
        .upload-btn:hover { background: var(--primary-color); border-color: var(--primary-color); }
        .upload-btn svg { width: 16px; height: 16px; }

        .playlist-item { 
            display: flex; gap: 12px; padding: 12px 20px; cursor: pointer; 
            border-bottom: 1px solid rgba(255,255,255,0.02); transition: background 0.2s; 
            position: relative;
        }
        .playlist-item:hover { background: rgba(255,255,255,0.05); }
        .playlist-item.active { background: rgba(99, 102, 241, 0.15); border-left: 3px solid var(--primary-color); }
        
        .playlist-item:hover .remove-btn { opacity: 1; }

        .thumb { width: 80px; height: 45px; background: #000; border-radius: 4px; object-fit: cover; display: flex; align-items: center; justify-content: center; color: #555; }
        .meta { overflow: hidden; flex: 1; }
        .meta h4 { font-size: 0.9rem; font-weight: 500; margin-bottom: 4px; color: #fff; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .meta p { font-size: 0.75rem; color: var(--text-muted); }

        /* --- 2. Remove Button --- */
        .remove-btn {
            background: rgba(239, 68, 68, 0.2); 
            color: var(--danger-color);
            border-radius: 4px; padding: 6px;
            opacity: 0; transition: all 0.2s;
            align-self: center;
        }
        .remove-btn:hover { background: var(--danger-color); color: white; }
        .remove-btn svg { width: 16px; height: 16px; }
        /* Always show remove button on touch devices or active item */
        .playlist-item.active .remove-btn { opacity: 1; }

    </style>
</head>
<body>

<header class="app-header">
    <div class="logo">
        <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 14.5v-9l6 4.5-6 4.5z"/></svg>
        Lumina<span>Player</span>
    </div>
    <div style="font-size: 0.9rem; color: #94a3b8;">v6.0</div>
</header>

<div class="app-container">
    <div class="lumina-player" id="videoContainer" tabindex="0">
        <video id="video" playsinline crossorigin="anonymous"></video>
        
        <div class="spinner" id="spinner"></div>

        <div class="overlay-center" id="centerOverlay">
            <div class="play-circle-bg">
                <svg viewBox="0 0 24 24" width="48" height="48" fill="white"><path d="M8 5v14l11-7z"/></svg>
            </div>
            <div class="welcome-text">Welcome to Lumina</div>
        </div>
        
        <div class="controls">
            <div class="progress-container">
                <div class="progress">
                    <div class="progress-filled" id="progressBar"></div>
                    <input type="range" min="0" max="100" step="0.1" value="0" class="seek-slider" id="seek">
                </div>
            </div>
            <div class="btn-group">
                <button id="playBtn"><svg class="play-icon" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg><svg class="pause-icon" viewBox="0 0 24 24" style="display:none;"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg></button>
                <div class="volume-container">
                    <button id="muteBtn"><svg viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg></button>
                    <input type="range" class="vol-slider" id="volume" min="0" max="1" step="0.05" value="1">
                </div>
                <div class="time"><span id="currentTime">00:00</span> / <span id="duration">00:00</span></div>
            </div>
            <div class="right-controls">
                <button id="pipBtn" title="Mini Player"><svg viewBox="0 0 24 24"><path d="M19 11h-8v6h8v-6zm4 8V4.98C23 3.88 22.1 3 21 3H3c-1.1 0-2 .88-2 1.98V19c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2zm-2 .02H3V4.97h18v14.05z"/></svg></button>
                <button id="fsBtn" title="Fullscreen"><svg viewBox="0 0 24 24"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg></button>
            </div>
        </div>
    </div>

    <div class="playlist" id="playlist">
        <div class="playlist-header">
            <span>Playlist</span>
            <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
                <svg viewBox="0 0 24 24"><path d="M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z"/></svg> Add Video
            </button>
            <input type="file" id="fileInput" accept="video/*" style="display: none;" multiple>
        </div>
        </div>
</div>

<script>
    const STORAGE_KEY_INDEX = 'lumina_index';
    const STORAGE_KEY_TIME  = 'lumina_time';
    
    // Default Data
    let playlistData = [
        { title: "Tears of Steel", src: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/TearsOfSteel.mp4", poster: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/images/TearsOfSteel.jpg", duration: "12:14", type: 'cloud' },
        { title: "Big Buck Bunny", src: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4", poster: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/images/BigBuckBunny.jpg", duration: "09:56", type: 'cloud' }
    ];

    let currentTrackIndex = 0;
    
    // Elements
    const video = document.getElementById('video');
    const container = document.getElementById('videoContainer');
    const playlistEl = document.getElementById('playlist');
    const playBtn = document.getElementById('playBtn');
    const playIcon = container.querySelector('.play-icon');
    const pauseIcon = container.querySelector('.pause-icon');
    const centerOverlay = document.getElementById('centerOverlay');
    const progressFilled = document.getElementById('progressBar');
    const seekSlider = document.getElementById('seek');
    const timeDisplay = document.getElementById('currentTime');
    const durationDisplay = document.getElementById('duration');
    const fileInput = document.getElementById('fileInput');
    const spinner = document.getElementById('spinner');

    function init() {
        const savedIndex = localStorage.getItem(STORAGE_KEY_INDEX);
        if (savedIndex !== null && playlistData[savedIndex] && playlistData[savedIndex].type === 'cloud') {
            currentTrackIndex = parseInt(savedIndex, 10);
        }
        renderPlaylist();
        if(playlistData.length > 0) loadTrack(currentTrackIndex, true);
    }

    function loadTrack(index, isRestoring = false) {
        if (!playlistData[index]) return; // Guard clause
        
        currentTrackIndex = index;
        const track = playlistData[index];
        
        if(track.type === 'cloud') localStorage.setItem(STORAGE_KEY_INDEX, index);

        video.src = track.src;
        
        if(track.poster) video.poster = track.poster;
        else video.removeAttribute('poster');
        
        renderPlaylist();
        
        if (isRestoring && track.type === 'cloud') {
            const savedTime = localStorage.getItem(STORAGE_KEY_TIME);
            if (savedTime) video.currentTime = parseFloat(savedTime);
            updatePlayState(); // Stay paused on restore
        } else {
            video.play().catch(console.log);
        }
    }

    function removeTrack(index, event) {
        event.stopPropagation(); // Prevent the click from playing the video
        
        const wasPlaying = (index === currentTrackIndex);
        
        // Remove from array
        playlistData.splice(index, 1);
        
        // Logic for which track to play next
        if (playlistData.length === 0) {
            video.src = "";
            video.removeAttribute('poster');
            renderPlaylist();
            return;
        }

        if (index < currentTrackIndex) {
            currentTrackIndex--; // Shift index down
        } else if (index === currentTrackIndex) {
            // We deleted the currently playing video
            // If we deleted the last one, go to 0, else stay at current (which is now the next one)
            if (currentTrackIndex >= playlistData.length) {
                currentTrackIndex = 0;
            }
            loadTrack(currentTrackIndex);
        }
        
        renderPlaylist();
    }

    function renderPlaylist() {
        const header = playlistEl.firstElementChild;
        playlistEl.innerHTML = '';
        playlistEl.appendChild(header);

        if (playlistData.length === 0) {
            playlistEl.innerHTML += `<div style="padding: 20px; text-align: center; color: #64748b;">No videos in playlist</div>`;
            return;
        }

        playlistData.forEach((track, index) => {
            const item = document.createElement('div');
            item.className = `playlist-item ${index === currentTrackIndex ? 'active' : ''}`;
            item.onclick = () => loadTrack(index);
            
            let thumbContent = track.poster 
                ? `<img src="${track.poster}" class="thumb">` 
                : `<div class="thumb"><svg width="24" height="24" viewBox="0 0 24 24" fill="#fff"><path d="M8 5v14l11-7z"/></svg></div>`;

            item.innerHTML = `
                ${thumbContent}
                <div class="meta">
                    <h4>${track.title}</h4>
                    <p>${track.duration || 'Local File'}</p>
                </div>
                <button class="remove-btn" onclick="removeTrack(${index}, event)" title="Remove Video">
                    <svg viewBox="0 0 24 24"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg>
                </button>
            `;
            playlistEl.appendChild(item);
        });
    }

    fileInput.addEventListener('change', (e) => {
        const files = Array.from(e.target.files);
        if(files.length === 0) return;
        files.forEach(file => {
            const blobUrl = URL.createObjectURL(file);
            playlistData.push({ title: file.name, src: blobUrl, poster: null, duration: "Local", type: 'local' });
        });
        renderPlaylist();
        loadTrack(playlistData.length - files.length);
    });

    function togglePlay() { 
        if(playlistData.length === 0) return;
        video.paused ? video.play() : video.pause(); 
    }
    
    function updatePlayState() {
        // Paused State
        if (video.paused) {
            playIcon.style.display = 'block'; 
            pauseIcon.style.display = 'none'; 
            container.classList.add('paused');
        } else {
            // Playing State
            playIcon.style.display = 'none'; 
            pauseIcon.style.display = 'block'; 
            container.classList.remove('paused');
        }
    }

    video.addEventListener('timeupdate', () => {
        if (!video.duration) return;
        const percent = (video.currentTime / video.duration) * 100;
        progressFilled.style.width = `${percent}%`;
        seekSlider.value = percent;
        
        const format = s => {
            if(isNaN(s)) return "0:00";
            const m = Math.floor(s/60), sec = Math.floor(s%60);
            return `${m}:${sec<10?'0':''}${sec}`;
        };
        timeDisplay.textContent = format(video.currentTime);
        if(video.duration) durationDisplay.textContent = format(video.duration);
    });

    const saveProgress = () => {
        if(playlistData[currentTrackIndex]?.type === 'cloud' && video.currentTime > 0) {
            localStorage.setItem(STORAGE_KEY_TIME, video.currentTime);
        }
    };
    video.addEventListener('pause', saveProgress);
    window.addEventListener('beforeunload', saveProgress);
    setInterval(() => { if(!video.paused) saveProgress(); }, 5000);

    video.addEventListener('ended', () => {
        if (currentTrackIndex < playlistData.length - 1) loadTrack(currentTrackIndex + 1);
        else updatePlayState();
    });

    seekSlider.addEventListener('input', (e) => video.currentTime = (e.target.value / 100) * video.duration);
    playBtn.addEventListener('click', togglePlay);
    video.addEventListener('click', togglePlay);
    video.addEventListener('play', updatePlayState);
    video.addEventListener('pause', updatePlayState);
    video.addEventListener('waiting', () => spinner.style.display = 'block');
    video.addEventListener('canplay', () => spinner.style.display = 'none');

    document.getElementById('fsBtn').onclick = () => document.fullscreenElement ? document.exitFullscreen() : container.requestFullscreen();
    document.getElementById('pipBtn').onclick = () => document.pictureInPictureElement ? document.exitPictureInPicture() : video.requestPictureInPicture();
    
    document.addEventListener('keydown', (e) => { if(e.key === ' ' || e.key === 'k') { e.preventDefault(); togglePlay(); } });

    // Boot
    init();
</script>
</body>
</html>
